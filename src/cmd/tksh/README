see src/lib/libtksh for implementation details
